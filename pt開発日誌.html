<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>開発日記</title>
  <style>
    pre {
      font-family: monospace;
      border: 1px solid #ccc;
      padding: 0.5em;
      margin: 1em 0;
    }
  </style>
</head>

<body>
  <h1>2021.1.1</h1>

  <p>N予備校でグローバルにインストールしていたexpress-generator@4.16.0を使ってプロジェクトのひな形を作った。</p>
  <pre>
    express --view=pug pt
  </pre>

  <h2>helmet</h2>

  <p>helmetを追加した。</p>
  <pre>
    yarn add helmet@1.1.0
  </pre>
  <dl>
    <dt>app.js</dt>
    <dd>
      <pre>
    var helmet = require('helmet');

    app.use(helmet());
      </pre>
    </dd>
  </dl>

  <h2>passport</h2>

  <p>認証はpassportでtwitter認証にする。
    Googleのほうがよかったけれど、高橋君に聞いたところ、Googleは利用料金がかかるらしい（未確認）。</p>

  <ul>
    <li><a href="http://www.passportjs.org/">Passport.js（公式ドキュメント）</a></li>
    <li><a href="http://www.passportjs.org/docs/twitter/">Documentation: Twitter（公式ドキュメント）</a></li>
    <li><a href="https://knimon-software.github.io/www.passportjs.org/guide/twitter/">Passport|Twitter 日本語</a></li>
  </ul>

  <p>passport, passport-XXX, express-sessionの3点セットで使う感じ。
    passport-XXXは利用するOAuthストラテジーの種類によって決める。汎用的なものはpassport-oauth。
    N予備校で使ったのはpassport-github2。今回はTwitterのものを使うので、passport-twitter。
    express-sessionはWebアプリ内で認証情報をセッションで保持するために利用する。</p>

  <h1>2021.1.2</h1>

  
  <pre>
    yarn add passport
    yarn add passport-twitter
    yarn add express-session
  </pre>
  <p>passportをインストールした。v0.4.1がインストールされた。<br>
  passport-twitterをインストールした。v1.0.4がインストールされた。<br>
  express-sessionをインストールした。v1.17.1がインストールされた。</p>

  <p><a href="https://dev.twitter.com/">Twitter Developers</a>にアカウントを作り、API keyを取得した。
    アカウントはmillibarjp@gmail.comと携帯番号を使って新規で作成し（この際、同じメールアドレスを使っていた趣味のアカウントに紐づくメールアドレスを変更した）、
  利用目的を英語で書かされたり、かなり面倒だった。アプリの名前はpt-webにした（ptwebは登録済みの名前で使えなかった）。</p>

  <p>「Keys and tokens」からView KeysでAPI keyとsecretを確認した。</p>
  <pre>
API key:
modkhta63SvE68i3nuLnaxohR

API key secret:
XITbP4g5Eu0rEmPQutH08MpFZw20cfEQB4k7o0htu44XFfOqwp
</pre>

  <p>N予備校の「03.GitHubを使った外部認証の説明」と<a href="https://qiita.com/itagakishintaro/items/e5a0481b51e6a17b304c">Node.js + Express + passport-twitterで認証Webアプリをつくる</a>
  を参考にapp.jsにコードを追加した。</p>

  <p><a href="http://localhost:8000/auth/twitter">http://localhost:8000/auth/twitter</a>にアクセスするとTwitterの認証ページに飛ばされ、
  認証後に / にリダイレクトされるところまで成功した。</p>

  <h1>2021.1.3</h1>

  <p>ログインしていることがわかるようにpugのテンプレートにviews/loginを作った。ログアウト用のリンクを作った。
    Routerで特定のパスへのアクセスに認証が必要になる仕組みとしてensureAuthenticated関数を作った。
    ここまでで、N予備校の「03.GitHubを使った外部認証の説明」に沿った実装が完了した。
  </p>

  <p>req.userについて。N予備校には解説がないので公式ドキュメントを調べた。</p>

  <ul>
    <Li><a href="http://www.passportjs.org/docs/authenticate/">Documentation: Authenticate（公式ドキュメント）</a></Li>
    <Li><a href="https://knimon-software.github.io/www.passportjs.org/guide/authenticate/">Passport  | 認証（日本語）</a></Li>
  </ul>

  <h1>2021.1.4</h1>

  <h2>要件定義</h2>
  <p>「プリズナートレーニング管理Webアプリ」の機能要件は次の通り。</p>
  <ul>
    <li>ビッグ６の実施を記録できる</li>
    <li>ビッグ６の各ステップについて、セットごとのレップスを記録できる</li>
    <li>ビッグ６ごとに進捗状況を視覚的に確認できる</li>
    <li>記録を編集できる</li>
    <li>記録を削除できる</li>
  </ul>

  <h2>用語の定義</h2>

  <table>
    <tr><th>用語</th><th>英語表記</th><th>意味</th></tr>
    <tr>
      <td>ビッグ６</td>
      <td>big6</td>
      <td>このアプリで管理する筋トレ６大種目。1. プッシュアップ、2. スクワット、3. プルアップ、4. レッグレイズ、5. ブリッジ、6. ハンドスタンド</td>
    </tr>
    <tr>
      <td>ステップ</td>
      <td>step</td>
      <td>ビッグ６内の各種目は難易度に応じて10段階のステップに分けられる。つまり、全60種目となる。</td>
    </tr>
    <tr>
      <td>セット</td>
      <td>set</td>
      <td>ひとつの種目の実施回数。種目ごとに１～３セット行う。</td>
    </tr>
    <tr>
      <td>レップス</td>
      <td>reps</td>
      <td>１セット内での反復回数。セットとレップスを明確に区別するため、「回数」という表現を使わない。</td>
    </tr>
    <tr>
      <td>記録</td>
      <td>record</td>
      <td>筋トレの実施記録。ステップ、セットごとのレップス、実施日時をデータベースに記録する。</td>
    </tr>
    <tr>
      <td>レベル</td>
      <td>level</td>
      <td>ステップ内での目標セット数とレップス。
        初心者、中級者、上級者の3段階あり、種目ごとに異なる。上級者の標準をクリアすることが次のステップに挑戦してよい目安となる。</td>
    </tr>
  </table>

  <h2>URL設計</h2>
  <ul>
    <li>トップページ（ビッグ６の進捗状況が視覚的にわかる）</li>
    <li>記録の新規作成ページ</li>
    <li>過去の記録の編集・削除ページ</li>
  </ul>

  <table>
    <tr>
      <th>パス</th>
      <th>メソッド</th>
      <th>ページ内容</th>
    </tr>
    <tr>
      <td>/</td>
      <td>GET</td>
      <td>トップ/ビッグ６の進捗状況を視覚的に表示</td>
    </tr>
    <tr>
      <td></td>
      <td>GET</td>
      <td></td>
    </tr>
  </table>

  <h1>2021.1.11</h1>

  <p>N予備校の「16.認証の実装とテスト」に沿って最初のコミットを行った。</p>
  <pre>
echo "node_modules/" > .gitignore
git init
git add .
git commit -m "first commit"
  </pre>

  <p>routes/にlogin.jsとlogout.jsを作成した。</p>

  <p>テスト用のモジュールをインストールした。</p>
<pre>
yarn add mocha --dev
yarn add supertest --dev
yarn add passport-stub --dev
</pre>
<p>下記バージョンがインストールされた。</p>
<ul>
  <li>mocha@8.2.1</li>
  <li>supertest@6.0.1</li>
  <li>passport-stub@1.1.1</li>
</ul>

<p>packege.jsonにtestを追加した。</p>
<pre>
  "test": "node_modules/mocha/bin/mocha --timeout 10000"
</pre>

<p>test/test.jsにテストを追加した。</p>
<pre>
yarn test
</pre>

  







</body>

</html>